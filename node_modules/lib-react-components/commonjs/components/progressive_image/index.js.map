{"version":3,"sources":["../../../src/components/progressive_image/index.jsx"],"names":["ProgressiveImage","state","image","props","placeholder","loading","_onLoad","src","setState","_onError","e","onError","_loadImage","onload","onerror","Image","nextProps","nextSrc","children","Error","PureComponent","propTypes","PropTypes","func","isRequired","string","defaultProps"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;;;+eAD8C;;;AAG9C;;;IAGqBA,gB;;;;;;;;;;;;;;0MAuBnBC,K,GAAQ;AACNC,aAAO,MAAKC,KAAL,CAAWC,WADZ;AAENC,eAAS;AAFH,K,QAmCRC,O,GAAU,YAAM;AAAA,UACNC,GADM,GACE,MAAKJ,KADP,CACNI,GADM;;;AAGd,YAAKC,QAAL,CAAc;AACZN,eAAOK,GADK;AAEZF,iBAAS;AAFG,OAAd;AAID,K,QAMDI,Q,GAAW,UAACC,CAAD,EAAO;AAAA,UACRC,OADQ,GACI,MAAKR,KADT,CACRQ,OADQ;;;AAGhB,UAAIA,OAAJ,EAAa;AACXA,gBAAQD,CAAR;AACD;AACF,K,QAMDE,U,GAAa,UAACL,GAAD,EAAS;AACpB,UAAI,MAAKL,KAAT,EAAgB;AACd,cAAKA,KAAL,CAAWW,MAAX,GAAoB,IAApB;AACA,cAAKX,KAAL,CAAWY,OAAX,GAAqB,IAArB;AACD;;AAED,UAAMZ,QAAQ,IAAIa,KAAJ,EAAd;;AAEA,YAAKb,KAAL,GAAaA,KAAb;AACAA,YAAMW,MAAN,GAAe,MAAKP,OAApB;AACAJ,YAAMY,OAAN,GAAgB,MAAKL,QAArB;AACAP,YAAMK,GAAN,GAAYA,GAAZ;AACD,K;;;;;wCAnEmB;AAAA,UACVA,GADU,GACF,KAAKJ,KADH,CACVI,GADU;;;AAGlB,WAAKK,UAAL,CAAgBL,GAAhB;AACD;;;8CAEyBS,S,EAAW;AAAA;;AAAA,UAC3BT,GAD2B,GACnB,KAAKJ,KADc,CAC3BI,GAD2B;AAAA,UAEtBU,OAFsB,GAEGD,SAFH,CAE3BT,GAF2B;AAAA,UAEbH,WAFa,GAEGY,SAFH,CAEbZ,WAFa;;;AAInC,UAAIa,YAAYV,GAAhB,EAAqB;AACnB,aAAKC,QAAL,CAAc;AACZN,iBAAOE,WADK;AAEZC,mBAAS;AAFG,SAAd,EAGG,YAAM;AACP,iBAAKO,UAAL,CAAgBK,OAAhB;AACD,SALD;AAMD;AACF;;;2CAEsB;AACrB,UAAI,KAAKf,KAAT,EAAgB;AACd,aAAKA,KAAL,CAAWW,MAAX,GAAoB,IAApB;AACA,aAAKX,KAAL,CAAWY,OAAX,GAAqB,IAArB;AACD;AACF;;AAED;;;;;AAYA;;;;;;AAYA;;;;;;;;;AAkBA;;;;6BAIS;AAAA,mBACoB,KAAKb,KADzB;AAAA,UACCC,KADD,UACCA,KADD;AAAA,UACQG,OADR,UACQA,OADR;AAAA,UAECa,QAFD,GAEc,KAAKf,KAFnB,CAECe,QAFD;;;AAIP,UAAI,CAACA,QAAD,IAAa,OAAOA,QAAP,KAAoB,UAArC,EAAiD;AAC/C,cAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;AACD;;AAED,aAAOD,SAAShB,KAAT,EAAgBG,OAAhB,CAAP;AACD;;;;EA9G2Ce,oB;;AAAzBpB,gB,CACZqB,S,GAAY;AACjBH,YAAUI,oBAAUC,IAAV,CAAeC,UADR;AAEjB;;;AAGAb,WAASW,oBAAUC,IALF;AAMjB;;;AAGAnB,eAAakB,oBAAUG,MATN;AAUjB;;;AAGAlB,OAAKe,oBAAUG;AAbE,C;AADAzB,gB,CAiBZ0B,Y,GAAe;AACpBf,SADoB,qBACV,CAAE,CADQ;;AAEpBP,eAAa,EAFO;AAGpBG,OAAK;AAHe,C;kBAjBHP,gB","file":"index.js","sourcesContent":["import React, { PureComponent } from 'react'; // eslint-disable-line\nimport PropTypes from 'prop-types';\n\n/**\n * ProgressiveImage component\n */\nexport default class ProgressiveImage extends PureComponent {\n  static propTypes = {\n    children: PropTypes.func.isRequired,\n    /**\n     * Fired when an error occurs when uploading a picture\n     */\n    onError: PropTypes.func,\n    /**\n     * Path to preloaded image\n     */\n    placeholder: PropTypes.string,\n    /**\n     * Path to main image\n     */\n    src: PropTypes.string,\n  };\n\n  static defaultProps = {\n    onError() {},\n    placeholder: '',\n    src: '',\n  }\n\n  state = {\n    image: this.props.placeholder,\n    loading: true,\n  };\n\n  componentDidMount() {\n    const { src } = this.props;\n\n    this._loadImage(src);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { src } = this.props;\n    const { src: nextSrc, placeholder } = nextProps;\n\n    if (nextSrc !== src) {\n      this.setState({\n        image: placeholder,\n        loading: true,\n      }, () => {\n        this._loadImage(nextSrc);\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.image) {\n      this.image.onload = null;\n      this.image.onerror = null;\n    }\n  }\n\n  /**\n   * On load handler\n   */\n  _onLoad = () => {\n    const { src } = this.props;\n\n    this.setState({\n      image: src,\n      loading: false,\n    });\n  };\n\n  /**\n   * On error load handler\n   * @param {SytheticEvent} e\n   */\n  _onError = (e) => {\n    const { onError } = this.props;\n\n    if (onError) {\n      onError(e);\n    }\n  };\n\n  /**\n   * Load image handler\n   * @param {string} src\n   */\n  _loadImage = (src) => {\n    if (this.image) {\n      this.image.onload = null;\n      this.image.onerror = null;\n    }\n\n    const image = new Image();\n\n    this.image = image;\n    image.onload = this._onLoad;\n    image.onerror = this._onError;\n    image.src = src;\n  };\n\n  /**\n   * render\n   * @return {ReactElement} markup\n   */\n  render() {\n    const { image, loading } = this.state;\n    const { children } = this.props;\n\n    if (!children || typeof children !== 'function') {\n      throw new Error('ProgressiveImage requires a function as its only child');\n    }\n\n    return children(image, loading);\n  }\n}\n"]}